{ pkgs, stdenv, ... }:
let
  jdk-i386 = pkgs.jdk8_headless.overrideAttrs (old: rec {
    enableGnome2 = false;
    enableJavaFX = false;

    patches = [
      old.patches
      ./0001-bool-int-comparison.patch
      ./0002-Unsigned-narrowing.patch
      ./0003-Return-nullptr-on-error.patch
    ];

    # per https://openjdk.org/groups/build/doc/building.html:
    # > Also note that, despite what autoconf claims, setting CFLAGS will not accomplish
    # > anything. Instead use --with-extra-cflags (and similar for cxxflags and ldflags).
     configureFlags = old.configureFlags ++ [ 
#      "--with-target-bits=32"
       "--with-toolchain-type=clang"
     ];
     configureFlagsArray = [ ''
       --with-extra-cflags=-Wno-error=reserved-user-defined-literal -Wno-error=format-nonliteral -Wno-narrowing -D_GNU_SOURCE
     '' ];
  });

  sholva-jdk = jdk-i386.override {
    stdenv = stdenv;
  };
in
pkgs.enableDebugging sholva-jdk
